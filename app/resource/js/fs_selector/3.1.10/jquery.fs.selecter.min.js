/*
 * Selecter v3.1.10 - 2014-09-14
 * A jQuery plugin for replacing default select elements. Part of the Formstone Library.
 * http://formstone.it/selecter/
 *
 * Copyright 2014 Ben Plum; MIT Licensed
 */

(function(f,l){function B(a){var b;a=f.extend({},s,a||{});null===n&&(n=f("body"));b=f(this);for(var c=0,d=b.length;c<d;c++)C(b.eq(c),a);return b}function C(a,b){if(!a.hasClass("selecter-element")){b=f.extend({},b,a.data("selecter-options"));b.multiple=a.prop("multiple");b.disabled=a.is(":disabled");b.external&&(b.links=!0);var c=a.find(":selected");if(b.multiple||""===b.label)b.label="";else{var d=f("<option/>",{value:"","class":"selecter-placeholder",selected:!0});d.html(b.label);a.prepend(d)}var e=a.find("option, optgroup"),k=e.filter("option"),c=k.filter(":selected"),d=0<c.length?k.index(c):0,c=""!==b.label?b.label:c.text();b.tabIndex=a[0].tabIndex;a[0].tabIndex=-1;var g="",h;h='<div class="selecter '+b.customClass;q?h+=" mobile":b.cover&&(h+=" cover");h=b.multiple?h+" multiple":h+" closed";b.disabled&&(h+=" disabled");h+='" tabindex="'+b.tabIndex+'">';h+="</div>";b.multiple||(g=g+'<span class="selecter-selected">'+f("<span></span>").text(w(c,b.trim)).html(),g+="</span>");g+='<div class="selecter-options">';g+="</div>";a.addClass("selecter-element").wrap(h).after(g);c=a.parent(".selecter");e=f.extend({$select:a,$allOptions:e,$options:k,$selecter:c,$selected:c.find(".selecter-selected"),$itemsWrapper:c.find(".selecter-options"),index:-1,guid:D++},b);x(e);e.multiple||m(d-1,e);void 0!==f.fn.scroller&&e.$itemsWrapper.scroller();e.$selecter.on("touchstart.selecter",".selecter-selected",e,E).on("click.selecter",".selecter-selected",e,t).on("click.selecter",".selecter-item",e,y).on("close.selecter",e,p).data("selecter",e);e.$select.on("change.selecter",e,F);q||(e.$selecter.on("focus.selecter",e,G).on("blur.selecter",e,H),e.$select.on("focus.selecter",e,function(a){a.data.$selecter.trigger("focus")}))}}function x(a){for(var b="",c=a.links?"a":"span",d=0,e=0,k=a.$allOptions.length;e<k;e++){var g=a.$allOptions.eq(e);if("OPTGROUP"===g[0].tagName)b+='<span class="selecter-group',g.is(":disabled")&&(b+=" disabled"),b+='">'+g.attr("label")+"</span>";else{var h=g.val();g.attr("value")||g.attr("value",h);b+="<"+c+' class="selecter-item';g.hasClass("selecter-placeholder")&&(b+=" placeholder");g.is(":selected")&&(b+=" selected");g.is(":disabled")&&(b+=" disabled");b+='" ';b=a.links?b+('href="'+h+'"'):b+('data-value="'+h+'"');b+=">"+f("<span></span>").text(w(g.text(),a.trim)).html()+"</"+c+">";d++}}a.$itemsWrapper.html(b);a.$items=a.$selecter.find(".selecter-item")}function E(a){a.stopPropagation();var b=a.data;a=a.originalEvent;var c=b.timer;null!==c&&clearInterval(c);b.touchStartX=a.touches[0].clientX;b.touchStartY=a.touches[0].clientY;b.$selecter.on("touchmove.selecter",".selecter-selected",b,I).on("touchend.selecter",".selecter-selected",b,J)}function I(a){var b=a.data;a=a.originalEvent;(10<Math.abs(a.touches[0].clientX-b.touchStartX)||10<Math.abs(a.touches[0].clientY-b.touchStartY))&&b.$selecter.off("touchmove.selecter touchend.selecter")}function J(a){var b=a.data;b.$selecter.off("touchmove.selecter touchend.selecter click.selecter");b.timer=K(b.timer,1E3,function(){b.$selecter.on("click.selecter",".selecter-selected",b,t).on("click.selecter",".selecter-item",b,y)});t(a)}function t(a){a.preventDefault();a.stopPropagation();var b=a.data;if(!b.$select.is(":disabled"))if(f(".selecter").not(b.$selecter).trigger("close.selecter",[b]),b.mobile||!q||L)if(b.$selecter.hasClass("closed")){if(a.preventDefault(),a.stopPropagation(),a=a.data,!a.$selecter.hasClass("open")){var b=a.$selecter.offset(),c=n.outerHeight(),d=a.$itemsWrapper.outerHeight(!0);0<=a.index&&a.$items.eq(a.index).position();b.top+d>c&&a.$selecter.addClass("bottom");a.$itemsWrapper.show();a.$selecter.removeClass("closed").addClass("open");n.on("click.selecter-"+a.guid,":not(.selecter-options)",a,M);z(a)}}else b.$selecter.hasClass("open")&&p(a);else a=b.$select[0],l.document.createEvent?(b=l.document.createEvent("MouseEvents"),b.initMouseEvent("mousedown",!1,!0,l,0,0,0,0,0,!1,!1,!1,!1,0,null),a.dispatchEvent(b)):a.fireEvent&&a.fireEvent("onmousedown")}function M(a){a.preventDefault();a.stopPropagation();0===f(a.currentTarget).parents(".selecter").length&&p(a)}function p(a){a.preventDefault();a.stopPropagation();a=a.data;a.$selecter.hasClass("open")&&(a.$itemsWrapper.hide(),a.$selecter.removeClass("open bottom").addClass("closed"),n.off(".selecter-"+a.guid))}function y(a){a.preventDefault();a.stopPropagation();var b=f(this),c=a.data;c.$select.is(":disabled")||(c.$itemsWrapper.is(":visible")&&(b=c.$items.index(b),b!==c.index&&(m(b,c),u(c))),c.multiple||p(a))}function F(a,b){var c=f(this),d=a.data;b||d.multiple||(c=d.$options.index(d.$options.filter("[value='"+N(c.val())+"']")),m(c,d),u(d))}function G(a){a.preventDefault();a.stopPropagation();a=a.data;a.$select.is(":disabled")||a.multiple||(a.$selecter.addClass("focus").on("keydown.selecter-"+a.guid,a,O),f(".selecter").not(a.$selecter).trigger("close.selecter",[a]))}function H(a,b,c){a.preventDefault();a.stopPropagation();a=a.data;a.$selecter.removeClass("focus").off("keydown.selecter-"+a.guid);f(".selecter").not(a.$selecter).trigger("close.selecter",[a])}function O(a){var b=a.data;if(13===a.keyCode)b.$selecter.hasClass("open")&&(p(a),m(b.index,b)),u(b);else if(9!==a.keyCode&&!(a.metaKey||a.altKey||a.ctrlKey||a.shiftKey)){a.preventDefault();a.stopPropagation();var c=b.$items.length-1,d=0>b.index?0:b.index;if(-1<f.inArray(a.keyCode,v?[38,40,37,39]:[38,40]))d+=38===a.keyCode||v&&37===a.keyCode?-1:1,0>d&&(d=0),d>c&&(d=c);else{a=String.fromCharCode(a.keyCode).toUpperCase();var e,k;for(k=b.index+1;k<=c;k++)if(e=b.$options.eq(k).text().charAt(0).toUpperCase(),e===a){d=k;break}if(0>d||d===b.index)for(k=0;k<=c;k++)if(e=b.$options.eq(k).text().charAt(0).toUpperCase(),e===a){d=k;break}}0<=d&&(m(d,b),z(b))}}function m(a,b){var c=b.$items.eq(a),d=c.hasClass("selected");c.hasClass("disabled")||(b.multiple?d?(b.$options.eq(a).prop("selected",null),c.removeClass("selected")):(b.$options.eq(a).prop("selected",!0),c.addClass("selected")):-1<a&&a<b.$items.length?(d=c.html(),c.data("value"),b.$selected.html(d).removeClass("placeholder"),b.$items.filter(".selected").removeClass("selected"),b.$select[0].selectedIndex=a,c.addClass("selected"),b.index=a):""!==b.label&&b.$selected.html(b.label))}function z(a){var b=a.$items.eq(a.index),b=0<=a.index&&!b.hasClass("placeholder")?b.position():{left:0,top:0};void 0!==f.fn.scroller?a.$itemsWrapper.scroller("scroll",a.$itemsWrapper.find(".scroller-content").scrollTop()+b.top,0).scroller("reset"):a.$itemsWrapper.scrollTop(a.$itemsWrapper.scrollTop()+b.top)}function u(a){if(a.links){var b=a.$select.val();a.external?l.open(b):l.location.href=b}else a.callback.call(a.$selecter,a.$select.val(),a.index),a.$select.trigger("change",[!0])}function w(a,b){return 0===b?a:a.length>b?a.substring(0,b)+"...":a}function N(a){return"string"===typeof a?a.replace(/([;&,\.\+\*\~':"\!\^#$%@\[\]\(\)=>\|])/g,"\\$1"):a}function K(a,b,c,d){null!==a&&clearInterval(a);return!0===d?setInterval(c,b):setTimeout(c,b)}var D=0,A=l.navigator.userAgent||l.navigator.vendor||l.opera,v=/Firefox/i.test(A),q=/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(A),L=v&&q,n=null,s={callback:f.noop,cover:!1,customClass:"",label:"",external:!1,links:!1,mobile:!1,trim:0},r={defaults:function(a){s=f.extend(s,a||{});return f(this)},disable:function(a){return f(this).each(function(b,c){var d=f(c).parent(".selecter").data("selecter");if(d)if("undefined"!==typeof a){var e=d.$items.index(d.$items.filter("[data-value="+a+"]"));d.$items.eq(e).addClass("disabled");d.$options.eq(e).prop("disabled",!0)}else d.$selecter.hasClass("open")&&d.$selecter.find(".selecter-selected").trigger("click.selecter"),d.$selecter.addClass("disabled"),d.$select.prop("disabled",!0)})},destroy:function(){return f(this).each(function(a,b){var c=f(b).parent(".selecter").data("selecter");c&&(c.$selecter.hasClass("open")&&c.$selecter.find(".selecter-selected").trigger("click.selecter"),void 0!==f.fn.scroller&&c.$selecter.find(".selecter-options").scroller("destroy"),c.$select[0].tabIndex=c.tabIndex,c.$select.find(".selecter-placeholder").remove(),c.$selected.remove(),c.$itemsWrapper.remove(),c.$selecter.off(".selecter"),c.$select.off(".selecter").removeClass("selecter-element").show().unwrap())})},enable:function(a){return f(this).each(function(b,c){var d=f(c).parent(".selecter").data("selecter");if(d)if("undefined"!==typeof a){var e=d.$items.index(d.$items.filter("[data-value="+a+"]"));d.$items.eq(e).removeClass("disabled");d.$options.eq(e).prop("disabled",!1)}else d.$selecter.removeClass("disabled"),d.$select.prop("disabled",!1)})},refresh:function(){return r.update.apply(f(this))},update:function(){return f(this).each(function(a,b){var c=f(b).parent(".selecter").data("selecter");if(c){var d=c.index;c.$allOptions=c.$select.find("option, optgroup");c.$options=c.$allOptions.filter("option");c.index=-1;d=c.$options.index(c.$options.filter(":selected"));x(c);c.multiple||m(d,c)}})}};f.fn.selecter=function(a){return r[a]?r[a].apply(this,Array.prototype.slice.call(arguments,1)):"object"!==typeof a&&a?this:B.apply(this,arguments)};f.selecter=function(a){"defaults"===a&&r.defaults.apply(this,Array.prototype.slice.call(arguments,1))}})(jQuery,window);